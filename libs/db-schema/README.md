# Database Schema (@kanon-academy/db-schema)

This library contains the shared database schema, models, and types for the Kanon Academy platform, using Drizzle ORM and PostgreSQL.

## Purpose

The purpose of this library is to provide a single source of truth for the database structure. All applications in this monorepo that interact with the database should consume this package to ensure consistency and type safety.

## Contents

This library will house the following:

- **Drizzle Schemas**: Schema definitions written for Drizzle ORM.
- **Drizzle-Kit Migrations**: SQL migration files generated by `drizzle-kit`.
- **Types and Interfaces**: TypeScript types generated from or related to the database models, ensuring type-safe queries in other applications.

## Usage

Once models are defined, other applications can import them directly.

```typescript
import { User } from "@kanon-academy/db-schema";

// Example usage
const newUser: User = {
  id: 1,
  email: "test@example.com"
  // ... other properties
};
```

### Schema Definitions

#### table `users`

| Column              | Type           | Description                                               |
| ------------------- | -------------- | --------------------------------------------------------- |
| `id`                | `SERIAL`       | **Primary Key**                                           |
| `full_name`         | `TEXT`         | User's full name                                          |
| `email`             | `VARCHAR(256)` | **Unique**, Not Null                                      |
| `email_verified_at` | `TIMESTAMP`    | Nullable. Tracks when the email was verified.             |
| `password_hash`     | `VARCHAR(256)` | Not Null                                                  |
| `bio`               | `TEXT`         | A short user biography.                                   |
| `role`              | `VARCHAR(50)`  | Not Null (e.g., 'student', 'instructor')                  |
| `status`            | `VARCHAR(50)`  | Not Null, Default: 'active' (e.g., 'active', 'suspended') |
| `last_login_at`     | `TIMESTAMP`    | Nullable. Timestamp of the user's last login.             |
| `created_at`        | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |
| `updated_at`        | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |

#### table `categories`

| Column        | Type           | Description                          |
| ------------- | -------------- | ------------------------------------ |
| `id`          | `SERIAL`       | **Primary Key**                      |
| `name`        | `VARCHAR(100)` | **Unique**, Not Null                 |
| `description` | `TEXT`         | Optional description of the category |
| `created_at`  | `TIMESTAMP`    | Not Null, Default: `NOW()`           |
| `updated_at`  | `TIMESTAMP`    | Not Null, Default: `NOW()`           |

#### table `courses`

| Column               | Type           | Description                                |
| -------------------- | -------------- | ------------------------------------------ |
| `id`                 | `SERIAL`       | **Primary Key**                            |
| `title`              | `VARCHAR(256)` | Not Null                                   |
| `description`        | `TEXT`         | Detailed course description                |
| `featured_image_url` | `TEXT`         | The main promotional image for the course. |
| `category_id`        | `INTEGER`      | **Foreign Key** to `categories.id`         |
| `instructor_id`      | `INTEGER`      | **Foreign Key** to `users.id`              |
| `created_at`         | `TIMESTAMP`    | Not Null, Default: `NOW()`                 |
| `updated_at`         | `TIMESTAMP`    | Not Null, Default: `NOW()`                 |

#### table `milestones`

| Column        | Type           | Description                                               |
| ------------- | -------------- | --------------------------------------------------------- |
| `id`          | `SERIAL`       | **Primary Key**                                           |
| `course_id`   | `INTEGER`      | **Foreign Key** to `courses.id`                           |
| `title`       | `VARCHAR(256)` | Not Null                                                  |
| `description` | `TEXT`         | A brief summary of the milestone's goals                  |
| `order`       | `INTEGER`      | Not Null. Defines the milestone's sequence in the course. |
| `created_at`  | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |
| `updated_at`  | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |

#### table `lessons`

| Column         | Type           | Description                                               |
| -------------- | -------------- | --------------------------------------------------------- |
| `id`           | `SERIAL`       | **Primary Key**                                           |
| `milestone_id` | `INTEGER`      | **Foreign Key** to `milestones.id`                        |
| `title`        | `VARCHAR(256)` | Not Null                                                  |
| `content`      | `JSONB`        | Flexible content (e.g., video URL, markdown text)         |
| `order`        | `INTEGER`      | Not Null. Defines the lesson's sequence in the milestone. |
| `created_at`   | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |
| `updated_at`   | `TIMESTAMP`    | Not Null, Default: `NOW()`                                |

#### table `enrollments`

| Column       | Type        | Description                                                 |
| ------------ | ----------- | ----------------------------------------------------------- |
| `id`         | `SERIAL`    | **Primary Key**                                             |
| `user_id`    | `INTEGER`   | **Foreign Key** to `users.id`                               |
| `course_id`  | `INTEGER`   | **Foreign Key** to `courses.id`                             |
| `progress`   | `JSONB`     | Stores user progress, e.g., `{"completed_lessons": [1, 5]}` |
| `created_at` | `TIMESTAMP` | Not Null, Default: `NOW()`                                  |
| `updated_at` | `TIMESTAMP` | Not Null, Default: `NOW()`                                  |

---

_Â© 2025 Kanon Academy. All rights reserved._
